<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QH FbToolkit</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .border-box {
            border-radius: 10px;
            border: 2px solid #ddd;
            padding: 15px;
            margin-top: 20px;
        }
        .image-preview {
            display: flex;
            flex-wrap: wrap;
        }
        .image-preview img {
            max-width: 100px;
            margin: 5px;
        }
        .image-preview .btn-delete {
            display: block;
            text-align: center;
            cursor: pointer;
            color: red;
        }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <a class="navbar-brand" href="#">
        <img src="/icon.webp" width="30" height="30" alt="">
        QH FbToolkit
      </a>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="#">Home</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Post view</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Comment view</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Docs</a>
      </li>
    </ul>
  </div>
</nav>


<div class="container">
    <div class="row">
        <!-- Cột 1 -->
        <div class="col-md-8 pt-5">
            <div class="row pt-2 pb-5" style="border: 2px solid #ddd; border-radius: 10px;">
                <div class="col-md-12">
                    <h3>Auto post to group</h3>
                    <div class="form-group">
                        <label for="title">Title</label>
                        <input type="text" id="title" class="form-control" name="title">
                    </div>
                    <div class="form-group">
                        <label for="paragraph">Paragraph</label>
                        <textarea id="paragraph" class="form-control" name="paragraph" rows="14"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="images">Upload Images</label>
                        <input type="file" id="images" class="form-control-file" multiple>
                        <div class="image-preview" id="image-preview"></div>
                    </div>
                    <button id="submit" class="btn btn-primary">Save</button>
                </div>
            </div>
            <br>
            <br>
            <div class="row pt-2 pb-5" style="border: 2px solid #ddd; border-radius: 10px;">
                <div class="col-md-12">
                    <h3>Auto comment to page/group - <span style="color: red;">No support</span></h3>
                    <div class="form-group">
                        <label for="cmt-title">Comment Title</label>
                        <input type="text" id="cmt-title" class="form-control" name="cmt-title" disabled>
                    </div>
                    <div class="form-group">
                        <label for="comment">Comment</label>
                        <textarea id="comment" class="form-control" name="comment" rows="14" disabled></textarea>
                    </div>
                    <div class="form-group">
                        <label for="images">Upload Images</label>
                        <input type="file" id="images" class="form-control-file" multiple disabled>
                        <div class="image-preview" id="image-preview"></div>
                    </div>
                    <button id="submit" class="btn btn-primary" disabled>Submit</button>
                </div>
            </div>
        </div>

        <!-- Cột 2 -->
        <div class="col-md-4 pt-4">
            <div class="border-box" style="height: 36%; overflow-y: auto;">
                <ul id="post-list">
                    <!-- Danh sách bài đăng sẽ được chèn vào đây -->
                    <li><a href="#">Post 1</a></li>
                </ul>
            </div>
            <div class="border-box" style="height: 40%; overflow-y: auto;">
                <p>comment list...<br>No support</p>
            </div>
        </div>
    </div>
</div>

<div class="container">
  <footer class="py-3 my-4">
    <ul class="nav justify-content-center border-bottom pb-3 mb-3">
      <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Home</a></li>
      <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Features</a></li>
      <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Pricing</a></li>
      <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">FAQs</a></li>
      <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">About</a></li>
    </ul>
    <p class="text-center text-muted">© 2024 | NDH - Hue city</p>
  </footer>
</div>

<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
<script>
// Firebase configuration
var firebaseConfig = {
    databaseURL: "https://qhfbkit-default-rtdb.asia-southeast1.firebasedatabase.app/"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);

document.addEventListener('DOMContentLoaded', function() {
    var imageInput = document.getElementById('images');
    var imagePreview = document.getElementById('image-preview');
    var postList = document.getElementById('post-list');

    // Hiển thị danh sách bài đăng từ Firebase
    firebase.database().ref('/').on('value', function(snapshot) {
        postList.innerHTML = ''; // Clear the list before adding new items
        snapshot.forEach(function(childSnapshot) {
            var key = childSnapshot.key;
            var childData = childSnapshot.val();
            var li = `<li><a target="_blank" href="/view.html?post=${key}">${childData.title}</a></li>`;
            postList.innerHTML = li + postList.innerHTML; // Add new items at the top
        });
    });

    imageInput.addEventListener('change', function() {
        imagePreview.innerHTML = '';
        Array.from(imageInput.files).forEach(function(file, index) {
            var reader = new FileReader();
            reader.onload = function(e) {
                var img = document.createElement('img');
                img.src = e.target.result;
                var deleteButton = document.createElement('div');
                deleteButton.textContent = 'Delete';
                deleteButton.classList.add('btn-delete');
                deleteButton.addEventListener('click', function() {
                    imageInput.value = '';
                    imagePreview.removeChild(img.parentNode);
                });
                var container = document.createElement('div');
                container.appendChild(img);
                container.appendChild(deleteButton);
                imagePreview.appendChild(container);
            };
            reader.readAsDataURL(file);
        });
    });

    document.getElementById('submit').addEventListener('click', function() {
        var title = document.getElementById('title').value;
        var paragraph = document.getElementById('paragraph').value;
        var images = Array.from(imageInput.files).map(function(file) {
            return new Promise(function(resolve, reject) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    resolve(e.target.result);
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        });

        function removeVietnameseTones(str) {
            str = str.replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ/g, "a"); 
            str = str.replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ/g, "e"); 
            str = str.replace(/ì|í|ị|ỉ|ĩ/g, "i"); 
            str = str.replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ/g, "o"); 
            str = str.replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g, "u"); 
            str = str.replace(/ỳ|ý|ỵ|ỷ|ỹ/g, "y"); 
            str = str.replace(/đ/g, "d");
            str = str.replace(/À|Á|Ạ|Ả|Ã|Â|Ầ|Ấ|Ậ|Ẩ|Ẫ|Ă|Ằ|Ắ|Ặ|Ẳ|Ẵ/g, "A");
            str = str.replace(/È|É|Ẹ|Ẻ|Ẽ|Ê|Ề|Ế|Ệ|Ể|Ễ/g, "E");
            str = str.replace(/Ì|Í|Ị|Ỉ|Ĩ/g, "I");
            str = str.replace(/Ò|Ó|Ọ|Ỏ|Õ|Ô|Ồ|Ố|Ộ|Ổ|Ỗ|Ơ|Ờ|Ớ|Ợ|Ở|Ỡ/g, "O");
            str = str.replace(/Ù|Ú|Ụ|Ủ|Ũ|Ư|Ừ|Ứ|Ự|Ử|Ữ/g, "U");
            str = str.replace(/Ỳ|Ý|Ỵ|Ỷ|Ỹ/g, "Y");
            str = str.replace(/Đ/g, "D");
            str = str.replace(/ +/g, '-');
            return str.toLowerCase();
        }

        Promise.all(images).then(function(base64Images) {
            var cleanTitle = removeVietnameseTones(title);
            firebase.database().ref(cleanTitle).set({
                title: title,
                paragraph: paragraph,
                images: base64Images
            }).then(function() {
                alert('Post submitted successfully!');
                document.getElementById('title').value = '';
                document.getElementById('paragraph').value = '';
                imageInput.value = '';
                imagePreview.innerHTML = '';
            }).catch(function(error) {
                console.error('Error submitting post:', error);
            });
        });
    });
});
</script>


</body>
</html>
